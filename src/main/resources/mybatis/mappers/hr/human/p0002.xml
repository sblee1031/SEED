<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hr.human.p0002">
	<resultMap id="BaldResult" type="balVO">
		<result property="pk_BAL_CODE" column="pk_BAL_CODE" />
		<result property="fk_BAL_CODE" column="fk_BAL_CODE" />
		<result property="fk_BAL_SAWON_CODE" column="fk_BAL_SAWON_CODE" />
		<result property="bal_TITLE" column="bal_TITLE" />
		<result property="bal_NUM" column="bal_NUM" />
		<result property="bal_DIV_CODE" column="bal_DIV_CODE" />
		<result property="bal_DATE" column="bal_DATE" />
		<result property="bal_DETAILS" column="bal_DETAILS" />
		<result property="bal_INFO" column="bal_INFO" />
		<result property="bal_BEF_INFO" column="bal_BEF_INFO" />
		<result property="bal_AFT_INFO" column="bal_AFT_INFO" />
		<result property="bal_APPL_DATE" column="bal_APPL_DATE" />
		<result property="bal_LONELY" column="bal_LONELY" />
		<result property="bal_DEPT_NAME" column="bal_DEPT_NAME" />
		<result property="bal_POSITION_NAME" column="bal_POSITION_NAME" />
		<result property="bal_INT_USER_ID" column="bal_INT_USER_ID" />
		<result property="bal_INT_DATE" column="bal_INT_DATE" />
		<result property="bal_MOD_USER_ID" column="bal_MOD_USER_ID" />
		<result property="bal_MOD_DATE" column="bal_MOD_DATE" />
		<result property="pk_SAWON_CODE" column="pk_SAWON_CODE" />
		<result property="sawon_NAME" column="sawon_NAME" />
		<result property="workplace_NAME" column="workplace_NAME" />
		<result property="dept_NAME" column="dept_NAME" />
		<result property="pk_DEPT_CODE" column="pk_DEPT_CODE" />
		<result property="rank_NAME" column="rank_NAME" />
	</resultMap>
	
	<select id="Ballyeong" resultMap="BaldResult" parameterType="java.util.Map"> 
      	<![CDATA[
         	select DISTINCT bal_num, bal_title, bal_div_code, bal_date, fk_BAL_CODE
			from bal
      	]]>
	</select> 
	
	<select id="Sawon" resultMap="BaldResult" parameterType="java.util.Map"> 
      	<![CDATA[
         	select pk_sawon_code, sawon_name, dept_name, c.workplace_name
			from SAWON a, DEPT b, workplace c
      	]]>
      	<where>
      		a.fk_SAWON_WORKPLACE_CODE = c.pk_workplace_code
			and   a.fk_dept_code = b.pk_dept_code
			<if test="FK_DEPT_CODE != '' and FK_DEPT_CODE != null">
				and FK_DEPT_CODE = #{FK_DEPT_CODE, jdbcType=VARCHAR}
			</if>
			<if test="fk_BAL_CODE != '' and fk_BAL_CODE != null">
				and pk_sawon_code = #{fk_BAL_CODE, jdbcType=VARCHAR}
			</if>
      	</where>
	</select>
	 
	<select id="DeptList" resultMap="BaldResult" parameterType="java.util.Map"> 
     	 <![CDATA[
			select dept_NAME, PK_DEPT_CODE
			from DEPT
		]]>
	</select>
	
	<select id="Sawon_NC_1" resultMap="BaldResult" parameterType="java.util.Map"> 
     	 <![CDATA[
			select s.pk_sawon_code, s.sawon_name, d.dept_name, p.person_bc_detai_mngement_name as rank_name
			  from sawon s, dept d, person_bc_detai p
			   
		]]>
		<where>
			       s.fk_dept_code = d.pk_dept_code
			   and s.rank_name = p.person_bc_detai_mngement_name
			   and p.fk_person_bc_code_num = 'G4'
			   <if test="pk_DEPT_CODE != null and pk_DEPT_CODE != ''">
					and d.pk_dept_code=#{pk_DEPT_CODE, jdbcType=VARCHAR}
			   </if>
			   <if test="rank_NAME !=null and rank_NAME != ''">
					and s.rank_name=#{rank_NAME, jdbcType=VARCHAR}
			   </if>
		</where>
	</select>
	
	
	<select id="Sawon_Add_Search" resultMap="BaldResult" parameterType="java.util.Map"> 
     	 <![CDATA[
			select fk_BAL_SAWON_CODE,
		   		(select sawon_NAME
   			  	   from sawon
  			 	  where pk_SAWON_CODE = fk_BAL_SAWON_CODE) as sawon_NAME,
		   		(select dept_NAME
   			  	   from dept
  			 	  where pk_dept_code = (select fk_dept_code
                          			 	  from sawon
                         				 where pk_SAWON_CODE = fk_BAL_SAWON_CODE)) as dept_NAME,
		   		(select rank_NAME
   			  	   from sawon
  			 	  where pk_SAWON_CODE = fk_BAL_SAWON_CODE) as rank_NAME, 
  			 	  fk_BAL_CODE, bal_TITLE, bal_NUM, bal_DIV_CODE, bal_DATE
			from BAL
		]]>
		<where>
			bal_NUM = #{bal_NUM , jdbcType=VARCHAR}
			and bal_DIV_CODE = #{bal_DIV_CODE , jdbcType=VARCHAR}
		</where>
	</select>
	
	<update id="updateDataBal" parameterType="java.util.Map">
		update BAL
		set  bal_num = #{bal_NUM , jdbcType=VARCHAR},
			 bal_title = #{bal_TITLE , jdbcType=VARCHAR},
			 bal_div_code = #{bal_DIV_CODE , jdbcType=VARCHAR},
			 bal_date = #{bal_DATE , jdbcType=VARCHAR},
			 fk_BAL_CODE = #{fk_BAL_CODE , jdbcType=VARCHAR}
		where pk_bal_code = (select pk_bal_code
							   from bal 
							  where fk_bal_code IS NULL
								and bal_num = #{bal_NUM , jdbcType=VARCHAR}
								and bal_title = #{bal_TITLE , jdbcType=VARCHAR}
								and bal_div_code = #{bal_DIV_CODE , jdbcType=VARCHAR}
								and bal_date = #{bal_DATE , jdbcType=VARCHAR})
	</update>	
	 
	<insert id="insertDataBal" parameterType="java.util.Map">
		INSERT INTO BAL(pk_bal_code, 
                		bal_num, 
                		bal_title, 
                		bal_div_code, 
                		bal_date)
		VALUES(  (select trim(to_char(NVL(MAX(pk_bal_code),'0')+'1','0000'))from BAL),
        		#{bal_NUM, jdbcType=VARCHAR},
        		#{bal_TITLE, jdbcType=VARCHAR},
        		#{bal_DIV_CODE, jdbcType=VARCHAR},
        		#{bal_DATE, jdbcType=VARCHAR})
	</insert>
	
	<insert id="insertDataBal2" parameterType="java.util.Map">
			INSERT INTO BAL(pk_bal_code,
                			fk_BAL_CODE,
                			bal_TITLE,
                			bal_NUM, 
			                bal_DIV_CODE, 
                			bal_DATE,
                			fk_BAL_SAWON_CODE)
		VALUES(  (select trim(to_char(NVL(MAX(pk_bal_code),'0')+'1','0000'))from BAL),
				#{fk_BAL_CODE, jdbcType=VARCHAR},
				#{bal_TITLE, jdbcType=VARCHAR},
        		#{bal_NUM, jdbcType=VARCHAR},
        		#{bal_DIV_CODE, jdbcType=VARCHAR},
        		#{bal_DATE, jdbcType=VARCHAR},
        		#{fk_BAL_SAWON_CODE, jdbcType=VARCHAR})
	</insert>	
	
	<delete id="deleteDataBal" parameterType="java.util.Map">
		delete BAL
		where pk_BAL_CODE = #{pk_BAL_CODE}
	</delete>
     
</mapper>